
USE N2
GO


CREATE TABLE CARGO(
    CdCARGO INT PRIMARY KEY,
    NmCARGO VARCHAR(20),
    VrSALARIO MONEY
)
GO

CREATE TABLE DEPARTAMENTO(
    CdDERPATAMENTO INT PRIMARY KEY,
    NmDEPARTAMENTO VARCHAR(20),
    RAMAL INT
)
GO

CREATE TABLE FUNCIONARIO(
    NrMATRIC INT PRIMARY KEY,
    NmFUNC VARCHAR(30),
    DtADM DATE,
    SEXO CHAR(1),
    CdCARGO INT,
    CdDERPATAMENTO INT
)
GO

ALTER TABLE FUNCIONARIO
ADD CONSTRAINT FK_FUNCIONARIO_DEPARTAMENTO
FOREIGN KEY (CdDERPATAMENTO)
REFERENCES DEPARTAMENTO(CdDERPATAMENTO)
GO

ALTER TABLE Funcionario
ADD CONSTRAINT FK_FUNCIONARIO_CARGO
FOREIGN KEY (CdCARGO)
REFERENCES CARGO(CdCARGO)
GO

INSERT INTO CARGO (CdCARGO , NMCARGO , VRSALARIO ) VALUES
(1,'COZINHEIRA',350.00),
(2,'AUX. ESCRITORIO',450),
(3,'VIGIA',400.00),
(4,'MECANICO',750),
(5,'GERENTE',2300),
(6,'ESCRITUARIO',600)
GO

INSERT INTO DEPARTAMENTO (CdDERPATAMENTO, NmDEPARTAMENTO,RAMAL) VALUES
(1,'ADM',221),
(2,'OFC',235),
(3,'SERVICOS G.',248),
(4,'VENDAS',258)
GO

INSERT INTO FUNCIONARIO (NrMATRIC, NmFUNC,DtADM,SEXO,CdCARGO,CdDERPATAMENTO) VALUES
(1001,'JOAO', '1993-08-10','M',4,2),
(1004,'LUCIO', '1993-03-02','M',4,2),
(1034,'ROBERTO', '1973-08-02','M',2,1),
(1021,'JOSE', '1983-08-04','M',2,1),
(1029,'RUTH', '1987-02-11','F',1,3)
GO

/* 
Liste o nome do funcionário e nome do departamento onde trabalha, 
ordenado por código do departamento crescente e nome do funcionário decrescente
*/

SELECT F.NmFUNC , 
       D.NmDEPARTAMENTO
FROM FUNCIONARIO F
INNER JOIN DEPARTAMENTO	D ON F.CdDERPATAMENTO  = D.CdDERPATAMENTO 
ORDER BY 
F.CdDERPATAMENTO DESC,
D.CdDERPATAMENTO ASC

/*
Selecione o código e o nome do cargo de todos os cargos,
além da quantidade de funcionários cadastrados neste cargo, ordenados pelo nome do cargo. 
*/

SELECT C.CDCARGO, 
       C.NMCARGO,
       COUNT(F.CdCARGO) AS 'QTD'
FROM CARGO C 
INNER JOIN FUNCIONARIO F ON C.CdCARGO = F.CdCARGO
GROUP BY C.CdCARGO , C.NmCARGO
ORDER BY C.NmCARGO

/*
Exiba a média dos salários de todos os funcionários.
*/

SELECT AVG(C.VRSALARIO) AS 'MEDIA SALARIAL'
FROM CARGO C
INNER JOIN FUNCIONARIO F ON C.CDCARGO = F.CdCARGO 

/*
Liste o nome do cargo e a somatória do salário de todos os funcionários que 
trabalham neste cargo. Faça o agrupamento por código do cargo.
*/

SELECT C.NMCARGO,
     SUM(C.VrSALARIO) AS 'SOMA($) DO SETOR'
FROM CARGO C
INNER JOIN FUNCIONARIO F ON C.CdCARGO = F.CdCARGO
GROUP BY C.CdCARGO , NmCARGO

SELECT D.CdDERPATAMENTO,
       D.NmDEPARTAMENTO,
       COUNT(*) AS 'QUANTIDADE FUNCIONARIOS'
FROM DEPARTAMENTO D 
INNER JOIN FUNCIONARIO F ON F.CdDERPATAMENTO = D.CdDERPATAMENTO
GROUP BY D.CdDERPATAMENTO , D.NmDEPARTAMENTO
HAVING COUNT(*) >= 2





 




